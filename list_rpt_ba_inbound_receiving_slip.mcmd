<command>
  <name>list rpt ba inbound receiving slip</name>
  <description>List data for report receiving slip and BA</description>
  <type>Local Syntax</type>
  <local-syntax>
<![CDATA[
get client in clause for user
 where usr_id = nvl(@usr_id, @@usr_id)
   and stoloc_wh_id = nvl(@wh_id, @@wh_id)
|
[select rcvLineDtl.trknum as asn,
        rcvLineDtl.client_id as customer,
        rcvLineDtl.supnum,
        rcvLineDtl.invnum as nomor_po,
        rcvLineDtl.wh_id,
        rcvLineDtl.prtnum,
        max(rcvLineDtl.stkuom) as stkuom,
        rcvLineDtl.prt_client_id,
        rcvLineDtl.adrnam,
        rcvLineDtl.trlr_num as container,
        rcvLineDtl.po_num,
        rcvLineDtl.invtyp,
        max(rcvLineDtl.expqty) expqty,
        max(rcvLineDtl.idnqty) idnqty,
        max(rcvLineDtl.rcvqty) rcvqty,
        max(rcvLineDtl.rptqty) rptqty,
        nvl(max(rcvLineDtl.exp_catch_qty), 0) exp_catch_qty,
        nvl(max(rcvLineDtl.idn_catch_qty), 0) idn_catch_qty,
        nvl(max(rcvLineDtl.rcv_catch_qty), 0) rcv_catch_qty,
        decode(count(distinct rcvLineDtl.orgcod), 1, max(rcvLineDtl.orgcod), max(rcvLineOrg.orgcod)) orgcod,
        decode(count(distinct rcvLineDtl.revlvl), 1, max(rcvLineDtl.revlvl), max(rcvLineDtl.revlvl)) revlvl,
        decode(count(distinct rcvLineDtl.lotnum), 1, max(rcvLineDtl.lotnum), max(rcvLineOrg.lotnum)) lotnum,
        decode(count(distinct rcvLineDtl.inv_attr_str1), 1, max(rcvLineDtl.inv_attr_str1), max(rcvLineDtl.inv_attr_str1)) inv_attr_str1,
        decode(count(distinct rcvLineDtl.inv_attr_str2), 1, max(rcvLineDtl.inv_attr_str2), max(rcvLineDtl.inv_attr_str2)) inv_attr_str2,
        decode(count(distinct rcvLineDtl.rcvsts), 1, max(rcvLineDtl.rcvsts), max(rcvLineOrg.rcvsts)) rcvsts,
        decode(count(distinct rcvLineDtl.mandte), 0, '', 1, max(rcvLineDtl.mandte), max(rcvLineOrg.mandte)) mandte,
        decode(count(distinct rcvLineDtl.expire_dte), 0, '', 1, max(rcvLineDtl.expire_dte), max(rcvLineOrg.expire_dte)) expire_dte,
        decode(count(distinct rcvLineDtl.retcod), 0, '', 1, max(rcvLineDtl.retcod), max(rcvLineOrg.retcod)) retcod,
        decode(count(distinct rcvLineDtl.cnsg_flg), 1, max(rcvLineDtl.cnsg_flg), max(rcvLineOrg.cnsg_flg)) cnsg_flg,
        decode(count(distinct rcvLineDtl.catch_unttyp), 0, '', 1, max(rcvLineDtl.catch_unttyp), @mlsMultiple) catch_unttyp,
        decode(count(distinct rcvLineDtl.short_dsc), 0, '', 1, max(rcvLineDtl.short_dsc), @mlsMultiple) short_dsc,
        decode(count(distinct rcvLineDtl.lngdsc), 0, '', 1, max(rcvLineDtl.lngdsc), @mlsMultiple) lngdsc,
        max(carcod) carcod,
        max(hot_flg) hot_flg,
        max(expdte) expected_date,
        max(completed_date) completed_date,
        max(grswgt) * 0.0283495 * max(rcvLineDtl.rcvqty) as gross_weight,
        max(netwgt) * 0.0283495 * max(rcvLineDtl.rcvqty) as netto_weight,
        floor(max(rcvLineDtl.rcvqty) / max(actual_ctn)) as actual_carton,
        decode(max(rcvLineDtl.dspuom), null, max(rcvLineDtl.stkuom), max(rcvLineDtl.dspuom)) dsp_untqty_uom,
        case when max(rcvLineDtl.stkuom) = max(rcvLineDtl.dspuom) then cast(floor(max(rcvLineDtl.rcvqty / actual_pcs)) as varchar(12)) + ' ' + decode(max(rcvLineDtl.dspuom), null, max(rcvLineDtl.stkuom), max(rcvLineDtl.dspuom))
             else cast(floor(max(rcvLineDtl.rcvqty) / max(actual_ctn)) as varchar(12)) + ' ' + cast(decode(max(rcvLineDtl.dspuom), null, max(rcvLineDtl.stkuom), max(rcvLineDtl.dspuom)) as varchar(12)) + ' ' + cast(decode(max(rcvLineDtl.dspuom), null, cast(null as int), max(rcvLineDtl.stkuom), cast(null as int), mod(max(rcvLineDtl.rcvqty), max(actual_pcs))) as varchar(12)) + ' ' + decode(max(rcvLineDtl.dspuom), null, null, max(rcvLineDtl.stkuom), null, max(rcvLineDtl.stkuom))
        end as quantity_reported,
        cast((select pdtl2.netwgt
                from prtftp_dtl pdtl2
               where pdtl2.ftpcod = max(rcvLineDtl.ftpcod)
                 and pdtl2.prtnum = max(rcvLineDtl.prtnum)
                 and pdtl2.prt_client_id = max(rcvLineDtl.prt_client_id)
                 and pdtl2.wh_id = max(rcvLineDtl.wh_id)
                 and pdtl2.uomcod = nvl(max(rcvLineDtl.dspuom), max(rcvLineDtl.stkuom))) / 35.274 * decode(max(rcvLineDtl.dspuom), null, max(rcvLineDtl.dtluntqty), max(rcvLineDtl.rcvqty) / max(rcvLineDtl.actual_ctn)) as decimal(10, 2)) as carton_weight,
        case when max(rcvLineDtl.stkuom) = max(rcvLineDtl.dspuom) then cast(max(rcvLineDtl.stkuom) + ' = ' + max(stkuom_lngdsc) as varchar(50))
             else cast(max(rcvLineDtl.stkuom) + ' = ' + max(stkuom_lngdsc) as varchar(50)) + ' & ' + cast(max(rcvLineDtl.dspuom) + ' = ' + max(dspuom_lngdsc) as varchar(50))
        end as uom_lngdsc
   from (select prtmst_view.catch_unttyp,
                prtmst_view.stkuom,
                prtmst_view.dspuom,
                prtdsc.short_dsc,
                prtdsc.lngdsc,
                rcvlin.*,
                trlr.trlr_num,
                trlr.carcod,
                rcvinv.po_num,
                rcvinv.invtyp,
                decode(trlr.hot_flg, 0, 0, decode((select count(rplwrk.rplref)
                                                     from rplwrk
                                                    where rplwrk.wh_id = rcvlin.wh_id
                                                      and rplwrk.prtnum = rcvlin.prtnum
                                                      and rplwrk.prt_client_id = rcvlin.prt_client_id), 0, 0, 1)) hot_flg,
                rcvtrk.expdte,
                rcvinv.completed_date,
                pdt.grswgt,
                pdt.netwgt,
                pdt.untqty as actual_pcs,
                pdt1.untqty as actual_ctn,
                pdt.ftpcod,
                rcvtrk.rcvtrk_stat,
                invdtl.untqty as dtluntqty,
                ddmst1.lngdsc as stkuom_lngdsc,
                ddmst2.lngdsc as dspuom_lngdsc,
                adrmst.adrnam
           from prtmst_view
           join prtdsc
             on prtdsc.colnam = 'prtnum|prt_client_id|wh_id_tmpl'
            and prtdsc.colval = /*=varchar(*/ prtmst_view.prtnum || '|' || prtmst_view.prt_client_id || '|' || prtmst_view.wh_id_tmpl /*=)*/
            and prtdsc.locale_id = nvl(@locale_id, @@locale_id)
           join rcvlin
             on prtmst_view.prtnum = rcvlin.prtnum
            and prtmst_view.prt_client_id = rcvlin.prt_client_id
            and prtmst_view.wh_id = rcvlin.wh_id
           join rcvtrk
             on rcvlin.trknum = rcvtrk.trknum
            and rcvlin.wh_id = rcvtrk.wh_id
           left outer
           join trlr
             on rcvtrk.trlr_id = trlr.trlr_id
           left outer
           join rcvinv
             on rcvlin.trknum = rcvinv.trknum
            and rcvlin.supnum = rcvinv.supnum
            and rcvlin.invnum = rcvinv.invnum
            and rcvlin.wh_id = rcvinv.wh_id
            and rcvlin.client_id = rcvinv.client_id
           join prtftp_dtl pdt
             on pdt.prtnum = prtmst_view.prtnum
            and pdt.prt_client_id = prtmst_view.prt_client_id
            and pdt.wh_id = prtmst_view.wh_id
            and pdt.uomlvl = 0
           join prtftp_dtl pdt1
             on pdt1.prtnum = prtmst_view.prtnum
            and pdt1.prt_client_id = prtmst_view.prt_client_id
            and pdt1.wh_id = prtmst_view.wh_id
            and pdt1.cas_flg = 1
           join invdtl
             on invdtl.rcvkey = rcvlin.rcvkey
           join dscmst ddmst1
             on ddmst1.colnam = 'uomcod'
            and ddmst1.colval = prtmst_view.stkuom
           join dscmst ddmst2
             on ddmst2.colnam = 'uomcod'
            and ddmst2.colval = prtmst_view.dspuom
           join client
             on client.client_id = prtmst_view.prt_client_id
           join adrmst
             on adrmst.adr_id = client.adr_id
          where @+prtmst_view.prtnum
            and @+rcvlin.mandte:date
            and @+rcvlin.expire_dte:date
            and @+rcvlin.moddte:date
            and @+rcvlin.wh_id
            and @+rcvlin.trknum
            and @+trlr.trlr_id
            and @+trlr.trlr_num
            and @+trlr.carcod
            and @+rcvlin.invnum
            and @+rcvlin.prt_client_id
            and @+rcvlin.rcvsts
            and @+rcvtrk.crncy_code
            and @*) rcvLineDtl
   left outer
   join rcvlin rcvLineOrg
     on rcvLineOrg.trknum = rcvLineDtl.trknum
    and rcvLineOrg.client_id = rcvLineDtl.client_id
    and rcvLineOrg.supnum = rcvLineDtl.supnum
    and rcvLineOrg.invnum = rcvLineDtl.invnum
    and rcvLineOrg.invlin = rcvLineDtl.invlin
    and rcvLineOrg.invsln = rcvLineDtl.invsln
    and rcvLineOrg.wh_id = rcvLineDtl.wh_id
    and rcvLineOrg.seqnum = 0
  where rcvlinedtl.rcvtrk_stat in ('C', 'R')
  group by rcvLineDtl.trknum,
        rcvLineDtl.client_id,
        rcvLineDtl.supnum,
        rcvLineDtl.invnum,
        rcvLineDtl.wh_id,
        rcvLineDtl.prtnum,
        rcvLineDtl.prt_client_id,
        rcvLineDtl.adrnam,
        rcvLineDtl.trlr_num,
        rcvLineDtl.po_num,
        rcvLineDtl.invtyp,
        rcvLineDtl.expdte,
        completed_date
  order by rcvLineDtl.trknum,
        rcvLineDtl.client_id,
        rcvLineDtl.supnum,
        rcvLineDtl.invnum,
        rcvLineDtl.wh_id]
]]>
</local-syntax>
</command>